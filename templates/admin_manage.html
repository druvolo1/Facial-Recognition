<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management Dashboard - Facial Recognition System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 25px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #333;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header .user-info {
            color: #666;
            font-size: 14px;
        }

        .location-context {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }

        .location-context select {
            padding: 6px 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .logout-btn, .dashboard-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-left: 10px;
        }

        .dashboard-btn {
            background: #6c757d;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        .dashboard-btn:hover {
            background: #5a6268;
        }

        /* Overview Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .stat-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .stat-card .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-card .stat-label {
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card.pending {
            border: 2px solid #ffc107;
        }

        .stat-card.pending .stat-value {
            color: #ffc107;
        }

        /* Alert Container */
        #alert-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            max-width: 400px;
        }

        /* Tabs */
        .tabs {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .tab-nav {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }

        .tab-button {
            flex: 1;
            min-width: 150px;
            padding: 18px;
            background: none;
            border: none;
            font-size: 15px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            position: relative;
        }

        .tab-button:hover {
            background: #e9ecef;
            color: #333;
        }

        .tab-button.active {
            color: #667eea;
            background: white;
            border-bottom-color: #667eea;
        }

        .tab-button .badge-count {
            position: absolute;
            top: 10px;
            right: 5px;
            background: #ffc107;
            color: #333;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: bold;
        }

        .tab-button .badge-count.info {
            background: #6c757d;
            color: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
            background: white;
            min-height: 500px;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
            font-size: 14px;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background: #f8f9fa;
        }

        /* Buttons */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 5px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-secondary {
            background: #e2e3e5;
            color: #383d41;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg, .empty-state .icon {
            font-size: 60px;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #667eea;
            font-size: 24px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 28px;
            color: #999;
            cursor: pointer;
            line-height: 1;
        }

        .close-modal:hover {
            color: #333;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Alerts */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Face Grid */
        .face-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .face-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
            overflow: hidden;
        }

        .face-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .face-card img {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .face-card h4 {
            color: #333;
            margin-bottom: 5px;
            margin-top: 5px;
            font-size: 16px;
            font-weight: 600;
        }

        .face-card p {
            color: #666;
            font-size: 13px;
            margin: 5px 0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .role-badge {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        /* Cropper.js styles */
        .cropper-container {
            max-width: 100%;
            max-height: 70vh;
        }

        .crop-preview-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .crop-preview-item {
            position: relative;
            cursor: pointer;
            border: 3px solid transparent;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s;
        }

        .crop-preview-item:hover {
            border-color: #667eea;
        }

        .crop-preview-item.selected {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        .crop-preview-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .cropper-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
    </style>

    <!-- Cropper.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div style="display: flex; align-items: center; gap: 20px; flex: 1;">
                <img src="/static/biometric-logo.svg" alt="BiometriX" style="height: 80px; background: white; padding: 6px 8px; border-radius: 10px; border: 2px solid #ddd; flex-shrink: 0;">
                <div>
                    <h1 style="margin-bottom: 5px;">
                        ‚öôÔ∏è Management Dashboard
                        <span class="role-badge" id="roleBadge">Loading...</span>
                    </h1>
                    <div class="user-info">
                        Logged in as: <strong>{{ user.email }}</strong>
                    </div>
                    <div class="location-context" id="locationContext" style="display: block; margin-top: 10px;">
                        <label>Filter by Location: </label>
                        <select id="managedLocationSelect" onchange="changeManagementLocation()">
                            <option value="">All Locations</option>
                        </select>
                    </div>
                </div>
            </div>
            <div style="flex-shrink: 0;">
                <button onclick="window.location.href='/dashboard'" class="dashboard-btn">Dashboard</button>
                <button onclick="logout()" class="logout-btn">Logout</button>
            </div>
        </div>

        <!-- Alert Container -->
        <div id="alert-container"></div>

        <!-- Overview Stats -->
        <div class="stats-grid" id="statsGrid">
            <div class="loading">
                <div class="spinner"></div>
                Loading overview...
            </div>
        </div>

        <!-- Tabbed Interface -->
        <div class="tabs">
            <div class="tab-nav" id="tabNav">
                <!-- Tabs will be dynamically added based on user role -->
            </div>

            <!-- Pending Approvals Tab -->
            <div id="pending-tab" class="tab-content">
                <div class="section-header">
                    <h2>‚ö†Ô∏è Pending Device Approvals</h2>
                </div>
                <div id="pending-devices-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading pending devices...
                    </div>
                </div>
            </div>

            <!-- Devices Tab -->
            <div id="devices-tab" class="tab-content">
                <div class="section-header">
                    <h2>üì± Devices</h2>
                </div>
                <div id="devices-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading devices...
                    </div>
                </div>
            </div>

            <!-- Registered Faces Tab -->
            <div id="faces-tab" class="tab-content">
                <div class="section-header">
                    <h2>üë• Registered Faces</h2>
                    <button class="btn btn-primary" onclick="showRegisterFaceModal()">+ Register New Face</button>
                </div>
                <div id="faces-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading registered faces...
                    </div>
                </div>
            </div>

            <!-- Users Tab (Superadmin only) -->
            <div id="users-tab" class="tab-content">
                <div class="section-header">
                    <h2>üë§ Users</h2>
                    <button class="btn btn-primary" onclick="showCreateUserModal()">+ Create User</button>
                </div>
                <div id="users-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading users...
                    </div>
                </div>
            </div>

            <!-- Locations Tab (Superadmin only) -->
            <div id="locations-tab" class="tab-content">
                <div class="section-header">
                    <h2>üìç Locations</h2>
                    <button class="btn btn-primary" onclick="showCreateLocationModal()">+ Create Location</button>
                </div>
                <div id="locations-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading locations...
                    </div>
                </div>
            </div>

            <!-- Servers Tab (Superadmin only) -->
            <div id="servers-tab" class="tab-content">
                <div class="section-header">
                    <h2>üñ•Ô∏è CodeProject Servers</h2>
                    <button class="btn btn-primary" onclick="showCreateServerModal()">+ Add Server</button>
                </div>
                <div id="servers-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading servers...
                    </div>
                </div>
            </div>

            <!-- Categories & Tags Tab -->
            <div id="categories-tab" class="tab-content">
                <div class="section-header">
                    <h2>üè∑Ô∏è Categories & Tags</h2>
                    <button class="btn btn-primary" onclick="showCreateCategoryModal()">+ Create Category</button>
                </div>
                <div id="categories-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading categories...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals (same as before) -->
    <!-- Approve Device Modal -->
    <div id="approve-device-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Approve Device</h2>
                <button class="close-modal" onclick="closeModal('approve-device-modal')">&times;</button>
            </div>
            <form id="approve-device-form">
                <input type="hidden" id="approve-device-id">
                <div class="form-group">
                    <label>Registration Code</label>
                    <input type="text" id="approve-device-code" disabled style="background: #e9ecef;">
                </div>
                <div class="form-group">
                    <label for="approve-device-name">Device Name *</label>
                    <input type="text" id="approve-device-name" required placeholder="e.g., Main Entrance Kiosk">
                </div>
                <div class="form-group">
                    <label for="approve-device-location">Location *</label>
                    <select id="approve-device-location" required>
                        <option value="">Select a location...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="approve-device-area">Area</label>
                    <select id="approve-device-area">
                        <option value="">No area assigned</option>
                    </select>
                    <p style="font-size: 11px; color: #888; margin-top: 4px;">Optional: Assign device to a specific area within the location</p>
                </div>
                <div class="form-group">
                    <label for="approve-device-type">Device Type *</label>
                    <select id="approve-device-type" required>
                        <option value="">Select a type...</option>
                        <option value="registration_kiosk">Registration Kiosk</option>
                        <option value="people_scanner">People Scanner</option>
                        <option value="location_dashboard">Location Dashboard</option>
                    </select>
                </div>
                <div class="form-group" id="approve-device-server-group" style="display: none;">
                    <label for="approve-device-server">CodeProject Server</label>
                    <select id="approve-device-server">
                        <option value="">Select a server...</option>
                    </select>
                </div>
                <div class="form-group" id="approve-device-processing-mode" style="display: none;">
                    <label>Image Processing Mode *</label>
                    <div style="margin-top: 8px;">
                        <label style="display: inline-flex; align-items: center; margin-right: 20px; cursor: pointer;">
                            <input type="radio" name="approve-processing-mode" value="server" checked style="margin-right: 8px;">
                            <span>Server (Flask ‚Üí CodeProject.AI)</span>
                        </label>
                        <label style="display: inline-flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="approve-processing-mode" value="direct" style="margin-right: 8px;">
                            <span>Direct (Device ‚Üí CodeProject.AI)</span>
                        </label>
                    </div>
                    <p style="font-size: 12px; color: #666; margin-top: 6px;">Server mode works anywhere but adds latency. Direct mode is faster but requires network access to CodeProject.AI.</p>
                </div>
                <div class="form-group" id="approve-device-scanner-settings" style="display: none;">
                    <h4 style="margin-bottom: 10px; color: #667eea;">Scanner Detection Settings</h4>
                    <p style="font-size: 12px; color: #666; margin-bottom: 10px;">Leave blank to use system defaults (.env file)</p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <label for="approve-device-confidence">Confidence Threshold (0.0-1.0)</label>
                            <input type="number" id="approve-device-confidence" step="0.01" min="0" max="1" placeholder="Default: 0.6">
                        </div>
                        <div>
                            <label for="approve-device-presence">Presence Timeout (minutes)</label>
                            <input type="number" id="approve-device-presence" step="1" min="1" placeholder="Default: 2">
                        </div>
                        <div>
                            <label for="approve-device-cooldown">Detection Cooldown (seconds)</label>
                            <input type="number" id="approve-device-cooldown" step="1" min="1" placeholder="Default: 10">
                        </div>
                    </div>
                </div>
                <div class="form-group" id="approve-device-dashboard-settings" style="display: none;">
                    <h4 style="margin-bottom: 10px; color: #667eea;">Dashboard Display Settings</h4>
                    <p style="font-size: 12px; color: #666; margin-bottom: 10px;">Leave blank to use system defaults (.env file)</p>
                    <div>
                        <label for="approve-device-dashboard-timeout">Display Timeout (minutes)</label>
                        <input type="number" id="approve-device-dashboard-timeout" step="1" min="1" placeholder="Default: 2">
                        <p style="font-size: 11px; color: #888; margin-top: 4px;">How long to show someone on the dashboard after their last detection</p>
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-success">Approve Device</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('approve-device-modal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Device Modal -->
    <div id="edit-device-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Device</h2>
                <button class="close-modal" onclick="closeModal('edit-device-modal')">&times;</button>
            </div>
            <form id="edit-device-form">
                <input type="hidden" id="edit-device-id">
                <div class="form-group">
                    <label for="edit-device-name">Device Name *</label>
                    <input type="text" id="edit-device-name" required>
                </div>
                <div class="form-group">
                    <label for="edit-device-location">Location *</label>
                    <select id="edit-device-location" required>
                        <option value="">Select a location...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-device-area">Area</label>
                    <select id="edit-device-area">
                        <option value="">No area assigned</option>
                    </select>
                    <p style="font-size: 11px; color: #888; margin-top: 4px;">Optional: Assign device to a specific area within the location</p>
                </div>
                <div class="form-group">
                    <label for="edit-device-type">Device Type *</label>
                    <select id="edit-device-type" required>
                        <option value="registration_kiosk">Registration Kiosk</option>
                        <option value="people_scanner">People Scanner</option>
                        <option value="location_dashboard">Location Dashboard</option>
                    </select>
                </div>
                <div class="form-group" id="edit-device-server-group">
                    <label for="edit-device-server">CodeProject Server *</label>
                    <select id="edit-device-server" required>
                        <option value="">Select a server...</option>
                    </select>
                </div>
                <div class="form-group" id="edit-device-processing-mode" style="display: none;">
                    <label>Image Processing Mode *</label>
                    <div style="margin-top: 8px;">
                        <label style="display: inline-flex; align-items: center; margin-right: 20px; cursor: pointer;">
                            <input type="radio" name="edit-processing-mode" value="server" checked style="margin-right: 8px;">
                            <span>Server (Flask ‚Üí CodeProject.AI)</span>
                        </label>
                        <label style="display: inline-flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="edit-processing-mode" value="direct" style="margin-right: 8px;">
                            <span>Direct (Device ‚Üí CodeProject.AI)</span>
                        </label>
                    </div>
                    <p style="font-size: 12px; color: #666; margin-top: 6px;">Server mode works anywhere but adds latency. Direct mode is faster but requires network access to CodeProject.AI.</p>
                </div>
                <div class="form-group" id="edit-device-scanner-settings" style="display: none;">
                    <h4 style="margin-bottom: 10px; color: #667eea;">Scanner Detection Settings</h4>
                    <p style="font-size: 12px; color: #666; margin-bottom: 10px;">Leave blank to use system defaults</p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <label for="edit-device-confidence">Confidence Threshold (0.0-1.0)</label>
                            <input type="number" id="edit-device-confidence" step="0.01" min="0" max="1" placeholder="Default: 0.6">
                        </div>
                        <div>
                            <label for="edit-device-presence">Presence Timeout (minutes)</label>
                            <input type="number" id="edit-device-presence" step="1" min="1" placeholder="Default: 2">
                        </div>
                        <div>
                            <label for="edit-device-cooldown">Detection Cooldown (seconds)</label>
                            <input type="number" id="edit-device-cooldown" step="1" min="1" placeholder="Default: 10">
                        </div>
                    </div>
                </div>
                <div class="form-group" id="edit-device-dashboard-settings" style="display: none;">
                    <h4 style="margin-bottom: 10px; color: #667eea;">Dashboard Display Settings</h4>
                    <p style="font-size: 12px; color: #666; margin-bottom: 10px;">Leave blank to use system defaults</p>
                    <div>
                        <label for="edit-device-dashboard-timeout">Display Timeout (minutes)</label>
                        <input type="number" id="edit-device-dashboard-timeout" step="1" min="1" placeholder="Default: 2">
                        <p style="font-size: 11px; color: #888; margin-top: 4px;">How long to show someone on the dashboard after their last detection</p>
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('edit-device-modal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create User Modal (Superadmin only) -->
    <div id="create-user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New User</h2>
                <button class="close-modal" onclick="closeModal('create-user-modal')">&times;</button>
            </div>
            <form id="create-user-form">
                <div class="form-group">
                    <label for="user-email">Email *</label>
                    <input type="email" id="user-email" required>
                </div>
                <div class="form-group">
                    <label for="user-password">Password *</label>
                    <input type="password" id="user-password" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="user-first-name">First Name</label>
                    <input type="text" id="user-first-name">
                </div>
                <div class="form-group">
                    <label for="user-last-name">Last Name</label>
                    <input type="text" id="user-last-name">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="user-is-superuser"> System Administrator
                    </label>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary">Create User</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('create-user-modal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Location Modal (Superadmin only) -->
    <div id="create-location-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New Location</h2>
                <button class="close-modal" onclick="closeModal('create-location-modal')">&times;</button>
            </div>
            <form id="create-location-form">
                <div class="form-group">
                    <label for="location-name">Location Name *</label>
                    <input type="text" id="location-name" required>
                </div>
                <div class="form-group">
                    <label for="location-address">Address</label>
                    <input type="text" id="location-address">
                </div>
                <div class="form-group">
                    <label for="location-description">Description</label>
                    <textarea id="location-description"></textarea>
                </div>
                <div class="form-group">
                    <label for="location-timezone">Timezone</label>
                    <input type="text" id="location-timezone" value="UTC">
                </div>
                <div class="form-group">
                    <label for="location-contact">Contact Info</label>
                    <input type="text" id="location-contact">
                </div>
                <div class="form-group">
                    <label for="location-server">CodeProject.AI Server</label>
                    <select id="location-server">
                        <option value="">None (will use first available)</option>
                    </select>
                    <small style="color: #666;">Select which server this location should use for face recognition</small>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary">Create Location</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('create-location-modal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Location Modal (Superadmin only) -->
    <div id="edit-location-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Location</h2>
                <button class="close-modal" onclick="closeModal('edit-location-modal')">&times;</button>
            </div>
            <form id="edit-location-form">
                <input type="hidden" id="edit-location-id">
                <div class="form-group">
                    <label for="edit-location-name">Name *</label>
                    <input type="text" id="edit-location-name" required>
                </div>
                <div class="form-group">
                    <label for="edit-location-address">Address</label>
                    <input type="text" id="edit-location-address">
                </div>
                <div class="form-group">
                    <label for="edit-location-description">Description</label>
                    <textarea id="edit-location-description"></textarea>
                </div>
                <div class="form-group">
                    <label for="edit-location-timezone">Timezone</label>
                    <input type="text" id="edit-location-timezone">
                </div>
                <div class="form-group">
                    <label for="edit-location-contact">Contact Info</label>
                    <input type="text" id="edit-location-contact">
                </div>
                <div class="form-group">
                    <label for="edit-location-server">CodeProject.AI Server</label>
                    <select id="edit-location-server">
                        <option value="">None (will use first available)</option>
                    </select>
                    <small style="color: #666;">Select which server this location should use for face recognition</small>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary">Update Location</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('edit-location-modal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create CodeProject Server Modal (Superadmin only) -->
    <div id="create-server-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add CodeProject.AI Server</h2>
                <button class="close-modal" onclick="closeModal('create-server-modal')">&times;</button>
            </div>
            <form id="create-server-form">
                <div class="form-group">
                    <label for="server-name">Friendly Name *</label>
                    <input type="text" id="server-name" required placeholder="e.g., Main Office Server">
                </div>
                <div class="form-group">
                    <label for="server-url">Endpoint URL (Legacy) *</label>
                    <input type="text" id="server-url" required placeholder="http://192.168.1.100:32168/v1">
                    <small style="color: #666;">For backward compatibility. Will be auto-filled if you provide public or LAN URL</small>
                </div>
                <div class="form-group">
                    <label for="server-public-url">Public Endpoint URL</label>
                    <input type="text" id="server-public-url" placeholder="https://codeproject.example.com/v1">
                    <small style="color: #666;">HTTPS endpoint with authentication (e.g., nginx reverse proxy)</small>
                </div>
                <div class="form-group">
                    <label for="server-lan-url">LAN Endpoint URL</label>
                    <input type="text" id="server-lan-url" placeholder="http://192.168.1.100:32168/v1">
                    <small style="color: #666;">Local LAN IP address, no authentication required</small>
                </div>
                <div class="form-group">
                    <label for="server-comm-preference">Server Communication Preference *</label>
                    <select id="server-comm-preference" required>
                        <option value="lan">LAN (Local Network)</option>
                        <option value="public">Public (HTTPS)</option>
                    </select>
                    <small style="color: #666;">How the Flask server should communicate with this CodeProject.AI server</small>
                </div>
                <div class="form-group">
                    <label for="server-description">Description</label>
                    <textarea id="server-description" placeholder="Optional notes about this server"></textarea>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="server-auth-enabled" style="margin-right: 8px;">
                        <span>Requires Authentication (HTTP Basic Auth)</span>
                    </label>
                    <small style="color: #666;">Enable if this server is protected by a reverse proxy with authentication</small>
                </div>
                <div id="server-auth-fields" style="display: none;">
                    <div class="form-group">
                        <label for="server-auth-username">Username *</label>
                        <input type="text" id="server-auth-username" placeholder="e.g., biometrix">
                    </div>
                    <div class="form-group">
                        <label for="server-auth-password">Password *</label>
                        <input type="password" id="server-auth-password" placeholder="Enter password">
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary">Add Server</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('create-server-modal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Server Modal -->
    <div id="edit-server-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit CodeProject.AI Server</h2>
                <button class="close-modal" onclick="closeModal('edit-server-modal')">&times;</button>
            </div>
            <form id="edit-server-form">
                <input type="hidden" id="edit-server-id">
                <div class="form-group">
                    <label for="edit-server-name">Friendly Name *</label>
                    <input type="text" id="edit-server-name" required placeholder="e.g., Main Office Server">
                </div>
                <div class="form-group">
                    <label for="edit-server-url">Endpoint URL (Legacy) *</label>
                    <input type="text" id="edit-server-url" required placeholder="http://192.168.1.100:32168/v1">
                    <small style="color: #666;">For backward compatibility. Will be auto-filled if you provide public or LAN URL</small>
                </div>
                <div class="form-group">
                    <label for="edit-server-public-url">Public Endpoint URL</label>
                    <input type="text" id="edit-server-public-url" placeholder="https://codeproject.example.com/v1">
                    <small style="color: #666;">HTTPS endpoint with authentication (e.g., nginx reverse proxy)</small>
                </div>
                <div class="form-group">
                    <label for="edit-server-lan-url">LAN Endpoint URL</label>
                    <input type="text" id="edit-server-lan-url" placeholder="http://192.168.1.100:32168/v1">
                    <small style="color: #666;">Local LAN IP address, no authentication required</small>
                </div>
                <div class="form-group">
                    <label for="edit-server-comm-preference">Server Communication Preference *</label>
                    <select id="edit-server-comm-preference" required>
                        <option value="lan">LAN (Local Network)</option>
                        <option value="public">Public (HTTPS)</option>
                    </select>
                    <small style="color: #666;">How the Flask server should communicate with this CodeProject.AI server</small>
                </div>
                <div class="form-group">
                    <label for="edit-server-description">Description</label>
                    <textarea id="edit-server-description" placeholder="Optional notes about this server"></textarea>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="edit-server-auth-enabled" style="margin-right: 8px;">
                        <span>Requires Authentication (HTTP Basic Auth)</span>
                    </label>
                    <small style="color: #666;">Enable if this server is protected by a reverse proxy with authentication</small>
                </div>
                <div id="edit-server-auth-fields" style="display: none;">
                    <div class="form-group">
                        <label for="edit-server-auth-username">Username</label>
                        <input type="text" id="edit-server-auth-username" placeholder="e.g., biometrix">
                    </div>
                    <div class="form-group">
                        <label for="edit-server-auth-password">Password</label>
                        <input type="password" id="edit-server-auth-password" placeholder="Leave blank to keep current password">
                        <small style="color: #666;">Only enter a new password if you want to change it</small>
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary">Update Server</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('edit-server-modal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Manage User Locations Modal (Superadmin only) -->
    <div id="manage-user-locations-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 id="user-locations-modal-title">Manage User Locations</h2>
                <button class="close-modal" onclick="closeModal('manage-user-locations-modal')">&times;</button>
            </div>
            <div id="user-locations-container">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading...
                </div>
            </div>
            <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #dee2e6;">
                <h3 style="margin-bottom: 15px;">Assign to New Location</h3>
                <form id="assign-location-form" style="display: flex; gap: 10px; align-items: flex-end;">
                    <div class="form-group" style="flex: 1; margin: 0;">
                        <label for="assign-location-select">Location</label>
                        <select id="assign-location-select" required>
                            <option value="">Select location...</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 1; margin: 0;">
                        <label for="assign-role-select">Role</label>
                        <select id="assign-role-select" required>
                            <option value="location_user">Location User</option>
                            <option value="location_admin">Location Admin</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Assign</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Manage Areas Modal -->
    <div id="manage-areas-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 id="manage-areas-title">Manage Areas</h2>
                <button class="close-modal" onclick="closeModal('manage-areas-modal')">&times;</button>
            </div>
            <div style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="showCreateAreaForm()">+ Add Area</button>
            </div>
            <div id="create-area-form" style="display: none; padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 10px;">Create New Area</h3>
                <form id="area-create-form" style="display: flex; gap: 10px; align-items: flex-end;">
                    <div class="form-group" style="flex: 2; margin: 0;">
                        <label for="create-area-name">Area Name *</label>
                        <input type="text" id="create-area-name" required placeholder="e.g., Lobby, Kitchen, Office">
                    </div>
                    <div class="form-group" style="flex: 3; margin: 0;">
                        <label for="create-area-description">Description</label>
                        <input type="text" id="create-area-description" placeholder="Optional description">
                    </div>
                    <button type="submit" class="btn btn-primary">Create</button>
                    <button type="button" class="btn btn-secondary" onclick="hideCreateAreaForm()">Cancel</button>
                </form>
            </div>
            <div id="areas-container">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading areas...
                </div>
            </div>
        </div>
    </div>

    <!-- Register Face Modal -->
    <div id="register-face-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>Register New Face</h2>
                <button class="close-modal" onclick="closeRegisterFaceModal()">&times;</button>
            </div>

            <!-- Step 1: Enter Name -->
            <div id="register-step-name" class="register-step active">
                <div style="padding: 20px;">
                    <h3 style="margin-bottom: 20px;">Enter Person's Name</h3>
                    <div class="form-group">
                        <label for="register-person-name">Full Name *</label>
                        <input type="text" id="register-person-name" placeholder="e.g., John Doe" autofocus>
                    </div>
                    <div class="form-group">
                        <label for="register-location-select">Location *</label>
                        <select id="register-location-select" required>
                            <option value="">Select a location...</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="register-name-continue" style="width: 100%;">Continue</button>
                </div>
            </div>

            <!-- Step 2: Choose Method -->
            <div id="register-step-method" class="register-step">
                <div style="padding: 20px;">
                    <h3 style="margin-bottom: 20px;">How would you like to add photos?</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <button class="btn btn-primary" id="choose-camera-btn" style="padding: 30px 20px; display: flex; flex-direction: column; align-items: center; gap: 10px;">
                            <span style="font-size: 48px;">üì∑</span>
                            <span style="font-size: 16px;">Use Camera</span>
                            <span style="font-size: 12px; opacity: 0.8;">Capture live photos</span>
                        </button>
                        <button class="btn btn-primary" id="choose-upload-btn" style="padding: 30px 20px; display: flex; flex-direction: column; align-items: center; gap: 10px;">
                            <span style="font-size: 48px;">üìÅ</span>
                            <span style="font-size: 16px;">Upload Files</span>
                            <span style="font-size: 12px; opacity: 0.8;">Select from device</span>
                        </button>
                    </div>
                    <button class="btn btn-secondary" onclick="goToRegisterStep('name')" style="width: 100%; margin-top: 15px;">‚Üê Back</button>
                </div>
            </div>

            <!-- Step 3: Camera & Capture -->
            <div id="register-step-camera" class="register-step">
                <div style="padding: 20px; background: #2a2a2a; border-radius: 8px;">
                    <h3 style="color: #667eea; margin-bottom: 10px;">Face Registration</h3>
                    <p style="color: #ccc; margin-bottom: 20px;">Press Begin and follow the voice prompts</p>

                    <div id="register-alert-container"></div>

                    <div style="position: relative; margin: 20px auto; background: #000; border-radius: 12px; overflow: hidden; max-width: 640px;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2;">
                            <div id="register-guidance-indicator" style="width: 200px; height: 200px; border: 3px solid rgba(102, 126, 234, 0.5); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #667eea; background: rgba(0,0,0,0.3); transition: all 0.3s;"></div>
                        </div>
                        <video id="register-camera" autoplay playsinline style="width: 100%; max-width: 640px; display: block;"></video>
                        <canvas id="register-canvas" style="display: none;"></canvas>
                    </div>

                    <div style="margin: 20px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: #ccc;">Progress:</span>
                            <span style="color: #ccc;"><span id="register-photo-count">0</span>/5 Photos</span>
                        </div>
                        <div style="height: 8px; background: #444; border-radius: 4px; overflow: hidden;">
                            <div id="register-progress-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); transition: width 0.3s;"></div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" onclick="goToRegisterStep('method')" style="flex: 0.5;">‚Üê Change Method</button>
                        <button class="btn btn-primary" id="register-begin-btn" style="flex: 1;">Begin Capture</button>
                        <button class="btn btn-success" id="register-submit-btn" disabled style="flex: 1;">Submit Registration</button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Upload & Edit -->
            <div id="register-step-upload" class="register-step">
                <div style="padding: 20px;">
                    <h3 style="margin-bottom: 20px;">Upload Photos</h3>
                    <p style="color: #666; margin-bottom: 15px;">Upload 3-5 photos of the person. You can rotate each image before submitting.</p>

                    <div id="upload-alert-container"></div>

                    <div class="form-group">
                        <label class="btn btn-primary" for="upload-photos-input" style="cursor: pointer; width: 100%; display: block; text-align: center;">
                            üìÅ Select Photos (3-5 recommended)
                        </label>
                        <input type="file" id="upload-photos-input" accept="image/jpeg,image/jpg,image/png,image/heic,image/webp" multiple style="display: none;">
                    </div>

                    <div id="upload-preview-container" style="margin-top: 20px;">
                        <!-- Photos will be shown here -->
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="goToRegisterStep('method')" style="flex: 0.5;">‚Üê Change Method</button>
                        <button class="btn btn-success" id="upload-submit-btn" disabled style="flex: 1;">Submit Registration</button>
                    </div>
                </div>
            </div>

            <!-- Step 5: Success -->
            <div id="register-step-success" class="register-step">
                <div style="padding: 40px; text-align: center;">
                    <div style="font-size: 72px; margin-bottom: 20px;">‚úÖ</div>
                    <h3 style="color: #667eea; margin-bottom: 15px;">Registration Complete!</h3>
                    <p style="color: #666; margin-bottom: 30px;"><span id="register-success-name"></span> has been successfully registered.</p>
                    <button class="btn btn-primary" onclick="closeRegisterFaceModal()" style="padding: 15px 40px;">Done</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Crop Photo Modal -->
    <div id="crop-photo-modal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>Crop Photo</h2>
                <button class="close-modal" onclick="closeCropModal()">&times;</button>
            </div>
            <div style="padding: 20px;">
                <p style="color: #666; margin-bottom: 15px;">Drag the corners to adjust the crop area. The cropped image will be used for face registration.</p>

                <div style="position: relative; display: inline-block; max-width: 100%; margin-bottom: 20px; background: #f5f5f5; border-radius: 8px; overflow: hidden;">
                    <canvas id="crop-source-canvas" style="max-width: 100%; display: block;"></canvas>
                    <div id="crop-box" style="position: absolute; border: 2px solid #667eea; background: rgba(102, 126, 234, 0.1); cursor: move;">
                        <div class="crop-handle" data-handle="nw" style="position: absolute; top: -5px; left: -5px; width: 10px; height: 10px; background: #667eea; cursor: nw-resize;"></div>
                        <div class="crop-handle" data-handle="ne" style="position: absolute; top: -5px; right: -5px; width: 10px; height: 10px; background: #667eea; cursor: ne-resize;"></div>
                        <div class="crop-handle" data-handle="sw" style="position: absolute; bottom: -5px; left: -5px; width: 10px; height: 10px; background: #667eea; cursor: sw-resize;"></div>
                        <div class="crop-handle" data-handle="se" style="position: absolute; bottom: -5px; right: -5px; width: 10px; height: 10px; background: #667eea; cursor: se-resize;"></div>
                    </div>
                </div>

                <div>
                    <h4 style="margin-bottom: 10px;">Preview:</h4>
                    <canvas id="crop-preview-canvas" style="max-width: 300px; max-height: 300px; border: 2px solid #e0e0e0; border-radius: 8px; background: #f5f5f5;"></canvas>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="closeCropModal()" style="flex: 1;">Cancel</button>
                    <button class="btn btn-primary" onclick="applyCrop()" style="flex: 1;">Apply Crop</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Category Modal -->
    <div id="create-category-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Category</h2>
                <button class="close-modal" onclick="closeModal('create-category-modal')">&times;</button>
            </div>
            <form id="create-category-form">
                <div class="form-group">
                    <label for="category-name">Category Name *</label>
                    <input type="text" id="category-name" required placeholder="e.g., Age Group, Relationship">
                </div>
                <div class="form-group">
                    <label for="category-description">Description</label>
                    <textarea id="category-description" rows="3" placeholder="Optional description"></textarea>
                </div>
                <div class="form-group">
                    <label for="category-scope">Scope *</label>
                    <select id="category-scope" required onchange="toggleCategoryLocation()">
                        <option value="">Select scope...</option>
                        <option value="global">Global (All Locations)</option>
                        <option value="location">Location-Specific</option>
                    </select>
                </div>
                <div class="form-group" id="category-location-group" style="display: none;">
                    <label for="category-location">Location *</label>
                    <select id="category-location">
                        <option value="">Select location...</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('create-category-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Category</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Category Modal -->
    <div id="edit-category-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Category</h2>
                <button class="close-modal" onclick="closeModal('edit-category-modal')">&times;</button>
            </div>
            <form id="edit-category-form">
                <input type="hidden" id="edit-category-id">
                <div class="form-group">
                    <label for="edit-category-name">Category Name *</label>
                    <input type="text" id="edit-category-name" required>
                </div>
                <div class="form-group">
                    <label for="edit-category-description">Description</label>
                    <textarea id="edit-category-description" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('edit-category-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Category</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Tag Modal -->
    <div id="create-tag-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Tag</h2>
                <button class="close-modal" onclick="closeModal('create-tag-modal')">&times;</button>
            </div>
            <form id="create-tag-form">
                <input type="hidden" id="tag-category-id">
                <div class="form-group">
                    <label>Category</label>
                    <input type="text" id="tag-category-name" disabled style="background: #e9ecef;">
                </div>
                <div class="form-group">
                    <label for="tag-name">Tag Name *</label>
                    <input type="text" id="tag-name" required placeholder="e.g., Child, Adult, Family">
                </div>
                <div class="form-group">
                    <label for="tag-description">Description</label>
                    <textarea id="tag-description" rows="3" placeholder="Optional description"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('create-tag-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Tag</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Tag Modal -->
    <div id="edit-tag-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Tag</h2>
                <button class="close-modal" onclick="closeModal('edit-tag-modal')">&times;</button>
            </div>
            <form id="edit-tag-form">
                <input type="hidden" id="edit-tag-id">
                <div class="form-group">
                    <label for="edit-tag-name">Tag Name *</label>
                    <input type="text" id="edit-tag-name" required>
                </div>
                <div class="form-group">
                    <label for="edit-tag-description">Description</label>
                    <textarea id="edit-tag-description" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('edit-tag-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Tag</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Assign Tags Modal -->
    <div id="assign-tags-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>Assign Tags to <span id="assign-tags-person-name"></span></h2>
                <button class="close-modal" onclick="closeModal('assign-tags-modal')">&times;</button>
            </div>
            <div id="assign-tags-container">
                <!-- Will be populated with categories and checkboxes -->
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('assign-tags-modal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="savePersonTags()">Save Tags</button>
            </div>
        </div>
    </div>

    <!-- Edit Expiration Modal -->
    <div id="edit-expiration-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Expiration for <span id="expiration-person-name"></span></h2>
                <button class="close-modal" onclick="closeModal('edit-expiration-modal')">&times;</button>
            </div>
            <div style="padding: 20px;">
                <div class="form-group">
                    <label for="expiration-date">Expiration Date</label>
                    <input type="date" id="expiration-date" class="form-control">
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="expiration-never" onchange="toggleExpirationNever()">
                        <span>Never expires (Employee)</span>
                    </label>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('edit-expiration-modal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveExpiration()">Save</button>
            </div>
        </div>
    </div>

    <!-- Edit Photos Modal -->
    <div id="edit-photos-modal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h2>Edit Photos for <span id="edit-photos-person-name"></span></h2>
                <button class="close-modal" onclick="closeEditPhotosModal()">&times;</button>
            </div>
            <div style="padding: 20px;">
                <div id="edit-photos-step-select" class="edit-photos-step">
                    <h3 style="margin-bottom: 15px;">Select a photo to crop:</h3>
                    <div id="edit-photos-list" class="crop-preview-list"></div>
                </div>

                <div id="edit-photos-step-crop" class="edit-photos-step" style="display: none;">
                    <div style="margin-bottom: 15px;">
                        <button class="btn btn-secondary btn-sm" onclick="backToPhotoSelection()">‚Üê Back to Photo Selection</button>
                    </div>
                    <h3 style="margin-bottom: 10px;">Crop Photo</h3>
                    <p style="color: #666; margin-bottom: 15px;">Adjust the crop area to focus on the face. The system will auto-detect the face initially.</p>
                    <div style="max-height: 60vh; overflow: hidden; margin-bottom: 15px;">
                        <img id="crop-target-image" style="max-width: 100%;">
                    </div>
                    <div class="cropper-buttons">
                        <button class="btn btn-secondary" onclick="resetCrop()">Reset</button>
                        <button class="btn btn-info" onclick="autoDetectFace()">Auto-Detect Face</button>
                        <button class="btn btn-primary" onclick="applyCroppedPhoto()">Apply & Save</button>
                    </div>
                </div>

                <div id="edit-photos-step-saving" class="edit-photos-step" style="display: none; text-align: center; padding: 40px;">
                    <div style="font-size: 48px; margin-bottom: 20px;">‚è≥</div>
                    <h3>Saving Changes...</h3>
                    <p style="color: #666;">Re-registering photos with CodeProject.AI</p>
                </div>
            </div>
            <div class="modal-actions" id="edit-photos-close-btn">
                <button type="button" class="btn btn-secondary" onclick="closeEditPhotosModal()">Close</button>
            </div>
        </div>
    </div>

    <style>
        .register-step {
            display: none;
        }
        .register-step.active {
            display: block;
        }

        /* Upload photo card styling */
        .upload-photo-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .upload-photo-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
        }

        .upload-photo-preview {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: 4px;
            margin-bottom: 10px;
            background: #f5f5f5;
        }

        .upload-photo-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .upload-photo-controls button {
            padding: 8px 12px;
            font-size: 14px;
        }

        /* Category/Tag styling */
        .category-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .category-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .scope-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .scope-badge.global {
            background: #dbeafe;
            color: #1e40af;
        }

        .scope-badge.location {
            background: #d1fae5;
            color: #065f46;
        }

        .tags-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .tag-item {
            background: #f3f4f6;
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .tag-item button {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0;
            font-size: 16px;
        }

        .tag-item button:hover {
            color: #dc2626;
        }

        .tag-checkbox-group {
            margin-bottom: 20px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
        }

        .tag-checkbox-group h4 {
            margin-bottom: 10px;
            color: #374151;
        }

        .tag-checkbox-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .tag-checkbox-list label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 5px;
        }

        .tag-checkbox-list input[type="checkbox"] {
            cursor: pointer;
        }
    </style>

    <script src="/static/js/admin-manage.js"></script>
</body>
</html>
