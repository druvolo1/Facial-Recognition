(venv) dave@Garden1:~/Facial-Recognition $ python app.py

************************************************************
*                                                          *
*  Face Recognition Server with CodeProject.AI            *
*                                                          *
************************************************************

Configuration:
  CodeProject.AI: http://172.16.1.150:32168/v1
  Flask Server: http://localhost:5000

Endpoints:
  - Home:         http://localhost:5000/
  - Registration: http://localhost:5000/register
  - Recognition:  http://localhost:5000/recognize
  - Diagnostics:  http://localhost:5000/diagnostics

============================================================
[STARTUP] Testing CodeProject.AI connection...
[STARTUP] Server: http://172.16.1.150:32168/v1
[STARTUP] ✓ CodeProject.AI server is REACHABLE (status: 200)
[STARTUP] ✓ Face recognition endpoints should be available
[STARTUP]   Register: POST http://172.16.1.150:32168/v1/vision/face/register
[STARTUP]   Recognize: POST http://172.16.1.150:32168/v1/vision/face/recognize
============================================================

Starting Flask server...
Press Ctrl+C to stop

 * Serving Flask app 'app'
 * Debug mode: on
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://172.16.1.102:5000
Press CTRL+C to quit
 * Restarting with stat

************************************************************
*                                                          *
*  Face Recognition Server with CodeProject.AI            *
*                                                          *
************************************************************

Configuration:
  CodeProject.AI: http://172.16.1.150:32168/v1
  Flask Server: http://localhost:5000

Endpoints:
  - Home:         http://localhost:5000/
  - Registration: http://localhost:5000/register
  - Recognition:  http://localhost:5000/recognize
  - Diagnostics:  http://localhost:5000/diagnostics

============================================================
[STARTUP] Testing CodeProject.AI connection...
[STARTUP] Server: http://172.16.1.150:32168/v1
[STARTUP] ✓ CodeProject.AI server is REACHABLE (status: 200)
[STARTUP] ✓ Face recognition endpoints should be available
[STARTUP]   Register: POST http://172.16.1.150:32168/v1/vision/face/register
[STARTUP]   Recognize: POST http://172.16.1.150:32168/v1/vision/face/recognize
============================================================

Starting Flask server...
Press Ctrl+C to stop

 * Debugger is active!
 * Debugger PIN: 127-923-956
172.16.1.150 - - [31/Oct/2025 20:51:34] "GET / HTTP/1.1" 200 -
172.16.1.150 - - [31/Oct/2025 20:51:34] "OPTIONS /api/displays/recognize HTTP/1.1" 200 -

[DISPLAY-REC] Recognition request from display_1761955874425 (Test Location)
[RESIZE] Image size (640, 480) is OK, no resize needed
[DISPLAY-REC] Detected 1 face(s) in 0.04s
172.16.1.150 - - [31/Oct/2025 20:51:34] "POST /api/displays/recognize HTTP/1.1" 200 -
172.16.1.150 - - [31/Oct/2025 20:51:36] "GET /greet HTTP/1.1" 200 -
172.16.1.150 - - [31/Oct/2025 20:51:36] "OPTIONS /api/displays/recognize HTTP/1.1" 200 -

[DISPLAY-REC] Recognition request from display_1761955874425 (Test Location)
[RESIZE] Image size (640, 480) is OK, no resize needed
[DISPLAY-REC] Detected 1 face(s) in 0.04s
172.16.1.150 - - [31/Oct/2025 20:51:36] "POST /api/displays/recognize HTTP/1.1" 200 -
172.16.1.150 - - [31/Oct/2025 20:51:38] "OPTIONS /api/displays/recognize HTTP/1.1" 200 -

[DISPLAY-REC] Recognition request from display_1761955874425 (Test Location)
[RESIZE] Image size (640, 480) is OK, no resize needed
[DISPLAY-REC] Detected 1 face(s) in 0.04s
172.16.1.150 - - [31/Oct/2025 20:51:38] "POST /api/displays/recognize HTTP/1.1" 200 -

============================================================
[RECOGNIZE] New recognition request at 20:51:40
[RECOGNIZE] Base64 data length: 34760 characters
[RECOGNIZE] Original image size: 25.46 KB
[RESIZE] Image size (640, 480) is OK, no resize needed
[RECOGNIZE] Final image size: 25.46 KB
[RECOGNIZE] Sending POST to: http://172.16.1.150:32168/v1/vision/face/recognize
[RECOGNIZE] Timeout set to: 30 seconds
[RECOGNIZE] Response received in 0.04 seconds
[RECOGNIZE] Status code: 200
[RECOGNIZE] Response JSON: {'message': 'A face was recognised', 'count': 1, 'predictions': [{'confidence': 0.778805136680603, 'userid': 'dave', 'x_min': 286, 'y_min': 238, 'x_max': 376, 'y_max': 350}], 'success': True, 'inferenceMs': 28, 'processMs': 31, 'code': 200, 'command': 'recognize', 'moduleId': 'FaceProcessing', 'executionProvider': 'CUDA', 'analysisRoundTripMs': 34}
[RECOGNIZE] Found 1 face prediction(s)
[RECOGNIZE]   Face #1: dave (confidence: 77.88%)
[RECOGNIZE] ✓ SUCCESS - Total time: 0.04s
============================================================

172.16.1.150 - - [31/Oct/2025 20:51:40] "POST /api/recognize HTTP/1.1" 200 -

============================================================
[TTS] Text-to-speech request at 20:51:40
[TTS] Text: Hello Dave, welcome!
[TTS] Generating audio with pyttsx3...
[TTS] ✗ Error generating audio: libespeak.so.1: cannot open shared object file: No such file or directory
Traceback (most recent call last):
  File "/home/dave/Facial-Recognition/venv/lib/python3.11/site-packages/pyttsx3/__init__.py", line 20, in init
    eng = _activeEngines[driverName]
          ~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/usr/lib/python3.11/weakref.py", line 136, in __getitem__
    o = self.data[key]()
        ~~~~~~~~~^^^^^
KeyError: 'sapi5'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/dave/Facial-Recognition/app.py", line 406, in text_to_speech
    engine = pyttsx3.init('sapi5')  # Windows SAPI5
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/dave/Facial-Recognition/venv/lib/python3.11/site-packages/pyttsx3/__init__.py", line 22, in init
    eng = Engine(driverName, debug)
          ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dave/Facial-Recognition/venv/lib/python3.11/site-packages/pyttsx3/engine.py", line 30, in __init__
    self.proxy = driver.DriverProxy(weakref.proxy(self), driverName, debug)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dave/Facial-Recognition/venv/lib/python3.11/site-packages/pyttsx3/driver.py", line 50, in __init__
    self._module = importlib.import_module(name)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1206, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1178, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1149, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 690, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 940, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/home/dave/Facial-Recognition/venv/lib/python3.11/site-packages/pyttsx3/drivers/sapi5.py", line 1, in <module>
    import comtypes.client  # Importing comtypes.client will make the gen subpackage
    ^^^^^^^^^^^^^^^^^^^^^^
ModuleNotFoundError: No module named 'comtypes'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/dave/Facial-Recognition/venv/lib/python3.11/site-packages/pyttsx3/__init__.py", line 20, in init
    eng = _activeEngines[driverName]
          ~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/usr/lib/python3.11/weakref.py", line 136, in __getitem__
    o = self.data[key]()
        ~~~~~~~~~^^^^^
KeyError: None

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/dave/Facial-Recognition/app.py", line 408, in text_to_speech
    engine = pyttsx3.init()  # Fallback to default
             ^^^^^^^^^^^^^^
  File "/home/dave/Facial-Recognition/venv/lib/python3.11/site-packages/pyttsx3/__init__.py", line 22, in init
    eng = Engine(driverName, debug)
          ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dave/Facial-Recognition/venv/lib/python3.11/site-packages/pyttsx3/engine.py", line 30, in __init__
    self.proxy = driver.DriverProxy(weakref.proxy(self), driverName, debug)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dave/Facial-Recognition/venv/lib/python3.11/site-packages/pyttsx3/driver.py", line 50, in __init__
    self._module = importlib.import_module(name)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1206, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1178, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1149, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 690, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 940, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/home/dave/Facial-Recognition/venv/lib/python3.11/site-packages/pyttsx3/drivers/espeak.py", line 9, in <module>
    from . import _espeak, toUtf8, fromUtf8
  File "/home/dave/Facial-Recognition/venv/lib/python3.11/site-packages/pyttsx3/drivers/_espeak.py", line 18, in <module>
    dll = cdll.LoadLibrary('libespeak.so.1')
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/ctypes/__init__.py", line 454, in LoadLibrary
    return self._dlltype(name)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/ctypes/__init__.py", line 376, in __init__
    self._handle = _dlopen(self._name, mode)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^
OSError: libespeak.so.1: cannot open shared object file: No such file or directory
172.16.1.150 - - [31/Oct/2025 20:51:40] "POST /api/tts HTTP/1.1" 500 -
172.16.1.150 - - [31/Oct/2025 20:51:40] "OPTIONS /api/displays/recognize HTTP/1.1" 200 -

[DISPLAY-REC] Recognition request from display_1761955874425 (Test Location)
[RESIZE] Image size (640, 480) is OK, no resize needed
[DISPLAY-REC] Detected 1 face(s) in 0.04s
172.16.1.150 - - [31/Oct/2025 20:51:40] "POST /api/displays/recognize HTTP/1.1" 200 -
172.16.1.150 - - [31/Oct/2025 20:51:42] "OPTIONS /api/displays/recognize HTTP/1.1" 200 -

[DISPLAY-REC] Recognition request from display_1761955874425 (Test Location)
[RESIZE] Image size (640, 480) is OK, no resize needed
[DISPLAY-REC] Detected 1 face(s) in 0.04s
172.16.1.150 - - [31/Oct/2025 20:51:42] "POST /api/displays/recognize HTTP/1.1" 200 -
