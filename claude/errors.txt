(venv) dave@Garden1:~/Facial-Recognition/app $ python main.py
[CONFIG] Database URL: mariadb+aiomysql://app_user:testpass123@172.16.1.150:3306/facial_recognition
[CONFIG] Base directory: /home/dave/Facial-Recognition
[CONFIG] Upload folder: /home/dave/Facial-Recognition/uploads
[CONFIG] CodeProject.AI: http://172.16.1.150:32168/v1
/home/dave/Facial-Recognition/app/main.py:435: DeprecationWarning:
        on_event is deprecated, use lifespan event handlers instead.

        Read more about it in the
        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).

  @app.on_event("startup")

************************************************************
*                                                          *
*  Facial Recognition App with Authentication              *
*                                                          *
************************************************************

Server will start at: http://localhost:5000
Login page: http://localhost:5000/login
Dashboard: http://localhost:5000/dashboard

Press Ctrl+C to stop

INFO:     Will watch for changes in these directories: ['/home/dave/Facial-Recognition/app']
INFO:     Uvicorn running on http://0.0.0.0:5000 (Press CTRL+C to quit)
INFO:     Started reloader process [517365] using StatReload
[CONFIG] Database URL: mariadb+aiomysql://app_user:testpass123@172.16.1.150:3306/facial_recognition
[CONFIG] Base directory: /home/dave/Facial-Recognition
[CONFIG] Upload folder: /home/dave/Facial-Recognition/uploads
[CONFIG] CodeProject.AI: http://172.16.1.150:32168/v1
[CONFIG] Database URL: mariadb+aiomysql://app_user:testpass123@172.16.1.150:3306/facial_recognition
[CONFIG] Base directory: /home/dave/Facial-Recognition
[CONFIG] Upload folder: /home/dave/Facial-Recognition/uploads
[CONFIG] CodeProject.AI: http://172.16.1.150:32168/v1
INFO:     Started server process [517371]
INFO:     Waiting for application startup.

============================================================
[STARTUP] Facial Recognition App starting...
[DB-INIT] Looking for .env file at: /home/dave/Facial-Recognition/.env
[DB-INIT] .env file exists: True
[DB-INIT] Connecting to MariaDB server at 172.16.1.150:3306
[DB-INIT] User: app_user
[DB-INIT] Target database: facial_recognition

============================================================
[DATABASE] Initializing database: facial_recognition
[DATABASE] Host: 172.16.1.150:3306
[DATABASE] User: app_user
[DATABASE] ✓ Database 'facial_recognition' already exists and is accessible
[STARTUP] ✓ Database tables created/verified
[STARTUP] ✓ Admin user already exists: admin@example.com
[STARTUP] ✓ Startup complete
============================================================

INFO:     Application startup complete.
INFO:     172.16.1.150:46412 - "GET /dashboard HTTP/1.1" 200 OK
INFO:     172.16.1.150:46416 - "GET /admin/locations HTTP/1.1" 200 OK
INFO:     172.16.1.150:46428 - "GET /api/locations HTTP/1.1" 200 OK
INFO:     172.16.1.150:46444 - "GET /api/admin/users HTTP/1.1" 200 OK
INFO:     172.16.1.150:46456 - "GET /api/pending-users HTTP/1.1" 200 OK
INFO:     172.16.1.150:46464 - "GET /api/devices/pending HTTP/1.1" 200 OK
INFO:     172.16.1.150:46468 - "GET /api/devices/pending HTTP/1.1" 200 OK
INFO:     172.16.1.150:46470 - "GET /api/devices?location_id=1 HTTP/1.1" 200 OK
INFO:     172.16.1.150:34176 - "DELETE /api/devices/1 HTTP/1.1" 404 Not Found
INFO:     172.16.1.150:42584 - "OPTIONS /api/devices/register-face HTTP/1.1" 200 OK

============================================================
[DEVICE-REGISTER] Device: dave broser (bcbb5dbd...)
[DEVICE-REGISTER] Location: 1
[DEVICE-REGISTER] Person: dave
[DEVICE-REGISTER] Photos: 6
[DEVICE-REGISTER] Processing photo 1/6
[DEVICE-REGISTER]   Image size: 66.62 KB
[DEVICE-REGISTER]   Saved locally: dave_20251101_200434_0.jpg
[DEVICE-REGISTER]   Sending to CodeProject.AI at http://mikenas.net:8787/...
[DEVICE-REGISTER]   ✗ Error on photo 1: HTTPConnectionPool(host='mikenas.net', port=8787): Max retries exceeded with url: //vision/face/register (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5228f850>: Failed to establish a new connection: [Errno 113] No route to host'))
[DEVICE-REGISTER] Processing photo 2/6
[DEVICE-REGISTER]   Image size: 66.40 KB
[DEVICE-REGISTER]   Saved locally: dave_20251101_200437_1.jpg
[DEVICE-REGISTER]   Sending to CodeProject.AI at http://mikenas.net:8787/...
[DEVICE-REGISTER]   ✗ Error on photo 2: HTTPConnectionPool(host='mikenas.net', port=8787): Max retries exceeded with url: //vision/face/register (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f52295310>: Failed to establish a new connection: [Errno 113] No route to host'))
[DEVICE-REGISTER] Processing photo 3/6
[DEVICE-REGISTER]   Image size: 67.23 KB
[DEVICE-REGISTER]   Saved locally: dave_20251101_200440_2.jpg
[DEVICE-REGISTER]   Sending to CodeProject.AI at http://mikenas.net:8787/...
[DEVICE-REGISTER]   ✗ Error on photo 3: HTTPConnectionPool(host='mikenas.net', port=8787): Max retries exceeded with url: //vision/face/register (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f52297590>: Failed to establish a new connection: [Errno 113] No route to host'))
[DEVICE-REGISTER] Processing photo 4/6
[DEVICE-REGISTER]   Image size: 67.87 KB
[DEVICE-REGISTER]   Saved locally: dave_20251101_200443_3.jpg
[DEVICE-REGISTER]   Sending to CodeProject.AI at http://mikenas.net:8787/...
[DEVICE-REGISTER]   ✗ Error on photo 4: HTTPConnectionPool(host='mikenas.net', port=8787): Max retries exceeded with url: //vision/face/register (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5229d810>: Failed to establish a new connection: [Errno 113] No route to host'))
[DEVICE-REGISTER] Processing photo 5/6
[DEVICE-REGISTER]   Image size: 66.32 KB
[DEVICE-REGISTER]   Saved locally: dave_20251101_200445_4.jpg
[DEVICE-REGISTER]   Sending to CodeProject.AI at http://mikenas.net:8787/...
[DEVICE-REGISTER]   ✗ Error on photo 5: HTTPConnectionPool(host='mikenas.net', port=8787): Max retries exceeded with url: //vision/face/register (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f52297cd0>: Failed to establish a new connection: [Errno 113] No route to host'))
[DEVICE-REGISTER] Processing photo 6/6
[DEVICE-REGISTER]   Image size: 67.15 KB
[DEVICE-REGISTER]   Saved locally: dave_20251101_200448_5.jpg
[DEVICE-REGISTER]   Sending to CodeProject.AI at http://mikenas.net:8787/...
[DEVICE-REGISTER]   ✗ Error on photo 6: HTTPConnectionPool(host='mikenas.net', port=8787): Max retries exceeded with url: //vision/face/register (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f52295c90>: Failed to establish a new connection: [Errno 113] No route to host'))
[DEVICE-REGISTER] Registration complete: 0/6 successful
============================================================

INFO:     172.16.1.150:42598 - "POST /api/devices/register-face HTTP/1.1" 500 Internal Server Error
^CINFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [517371]
INFO:     Stopping reloader process [517365]
(venv) dave@Garden1:~/Facial-Recognition/app $ python main.py
[CONFIG] Database URL: mariadb+aiomysql://app_user:testpass123@172.16.1.150:3306/facial_recognition
[CONFIG] Base directory: /home/dave/Facial-Recognition
[CONFIG] Upload folder: /home/dave/Facial-Recognition/uploads
[CONFIG] CodeProject.AI: http://172.16.1.150:32168/v1
/home/dave/Facial-Recognition/app/main.py:435: DeprecationWarning:
        on_event is deprecated, use lifespan event handlers instead.

        Read more about it in the
        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).

  @app.on_event("startup")

************************************************************
*                                                          *
*  Facial Recognition App with Authentication              *
*                                                          *
************************************************************

Server will start at: http://localhost:5000
Login page: http://localhost:5000/login
Dashboard: http://localhost:5000/dashboard

Press Ctrl+C to stop

INFO:     Will watch for changes in these directories: ['/home/dave/Facial-Recognition/app']
INFO:     Uvicorn running on http://0.0.0.0:5000 (Press CTRL+C to quit)
INFO:     Started reloader process [517703] using StatReload
[CONFIG] Database URL: mariadb+aiomysql://app_user:testpass123@172.16.1.150:3306/facial_recognition
[CONFIG] Base directory: /home/dave/Facial-Recognition
[CONFIG] Upload folder: /home/dave/Facial-Recognition/uploads
[CONFIG] CodeProject.AI: http://172.16.1.150:32168/v1
[CONFIG] Database URL: mariadb+aiomysql://app_user:testpass123@172.16.1.150:3306/facial_recognition
[CONFIG] Base directory: /home/dave/Facial-Recognition
[CONFIG] Upload folder: /home/dave/Facial-Recognition/uploads
[CONFIG] CodeProject.AI: http://172.16.1.150:32168/v1
INFO:     Started server process [517709]
INFO:     Waiting for application startup.

============================================================
[STARTUP] Facial Recognition App starting...
[DB-INIT] Looking for .env file at: /home/dave/Facial-Recognition/.env
[DB-INIT] .env file exists: True
[DB-INIT] Connecting to MariaDB server at 172.16.1.150:3306
[DB-INIT] User: app_user
[DB-INIT] Target database: facial_recognition

============================================================
[DATABASE] Initializing database: facial_recognition
[DATABASE] Host: 172.16.1.150:3306
[DATABASE] User: app_user
[DATABASE] ✓ Database 'facial_recognition' already exists and is accessible
[STARTUP] ✓ Database tables created/verified
[STARTUP] ✓ Admin user already exists: admin@example.com
[STARTUP] ✓ Startup complete
============================================================

INFO:     Application startup complete.
INFO:     172.16.1.150:54616 - "GET /admin/locations HTTP/1.1" 200 OK
INFO:     172.16.1.150:54624 - "GET /api/locations HTTP/1.1" 200 OK
INFO:     172.16.1.150:54636 - "GET /api/admin/users HTTP/1.1" 200 OK
INFO:     172.16.1.150:54646 - "GET /api/pending-users HTTP/1.1" 200 OK
INFO:     172.16.1.150:54662 - "GET /api/devices/pending HTTP/1.1" 200 OK
INFO:     172.16.1.150:54674 - "GET /api/devices/pending HTTP/1.1" 200 OK
INFO:     172.16.1.150:54690 - "GET /api/devices?location_id=1 HTTP/1.1" 200 OK
[DEVICE] Device updated by admin@example.com: bcbb5dbd-60ae-4077-94dc-d601c380b68e
INFO:     172.16.1.150:42588 - "PUT /api/devices/bcbb5dbd-60ae-4077-94dc-d601c380b68e HTTP/1.1" 200 OK
INFO:     172.16.1.150:42600 - "GET /api/devices?location_id=1 HTTP/1.1" 200 OK
INFO:     172.16.1.150:52832 - "OPTIONS /api/devices/register-face HTTP/1.1" 200 OK

============================================================
[DEVICE-REGISTER] Device: dave broser (bcbb5dbd...)
[DEVICE-REGISTER] Location: 1
[DEVICE-REGISTER] Person: dave
[DEVICE-REGISTER] Photos: 6
[DEVICE-REGISTER] Processing photo 1/6
[DEVICE-REGISTER]   Image size: 67.60 KB
[DEVICE-REGISTER]   Saved locally: dave_20251101_201140_0.jpg
[DEVICE-REGISTER]   Sending to CodeProject.AI at http://172.16.1.150:32168/...
[DEVICE-REGISTER]   ✗ Photo 1 failed with status 404
[DEVICE-REGISTER] Processing photo 2/6
[DEVICE-REGISTER]   Image size: 68.32 KB
[DEVICE-REGISTER]   Saved locally: dave_20251101_201140_1.jpg
[DEVICE-REGISTER]   Sending to CodeProject.AI at http://172.16.1.150:32168/...
[DEVICE-REGISTER]   ✗ Photo 2 failed with status 404
[DEVICE-REGISTER] Processing photo 3/6
[DEVICE-REGISTER]   Image size: 68.54 KB
[DEVICE-REGISTER]   Saved locally: dave_20251101_201140_2.jpg
[DEVICE-REGISTER]   Sending to CodeProject.AI at http://172.16.1.150:32168/...
[DEVICE-REGISTER]   ✗ Photo 3 failed with status 404
[DEVICE-REGISTER] Processing photo 4/6
[DEVICE-REGISTER]   Image size: 68.23 KB
[DEVICE-REGISTER]   Saved locally: dave_20251101_201140_3.jpg
[DEVICE-REGISTER]   Sending to CodeProject.AI at http://172.16.1.150:32168/...
[DEVICE-REGISTER]   ✗ Photo 4 failed with status 404
[DEVICE-REGISTER] Processing photo 5/6
[DEVICE-REGISTER]   Image size: 68.04 KB
[DEVICE-REGISTER]   Saved locally: dave_20251101_201140_4.jpg
[DEVICE-REGISTER]   Sending to CodeProject.AI at http://172.16.1.150:32168/...
[DEVICE-REGISTER]   ✗ Photo 5 failed with status 404
[DEVICE-REGISTER] Processing photo 6/6
[DEVICE-REGISTER]   Image size: 69.06 KB
[DEVICE-REGISTER]   Saved locally: dave_20251101_201140_5.jpg
[DEVICE-REGISTER]   Sending to CodeProject.AI at http://172.16.1.150:32168/...
[DEVICE-REGISTER]   ✗ Photo 6 failed with status 404
[DEVICE-REGISTER] Registration complete: 0/6 successful
============================================================

INFO:     172.16.1.150:52846 - "POST /api/devices/register-face HTTP/1.1" 500 Internal Server Error
INFO:     172.16.1.150:43896 - "GET /dashboard HTTP/1.1" 200 OK
INFO:     172.16.1.150:43912 - "GET /register HTTP/1.1" 200 OK

============================================================
[REGISTER] New registration request at 20:12:36
[REGISTER] User: dave
[REGISTER] Photos to register: 6
[REGISTER] Processing photo 1/6
[REGISTER]   Image size: 67.98 KB
[REGISTER]   Saved locally: dave_20251101_201236_0.jpg
[REGISTER]   Sending to CodeProject.AI...
[REGISTER]   ✓ Photo 1 registered successfully
[REGISTER]   ✓ Saved to database
[REGISTER] Processing photo 2/6
[REGISTER]   Image size: 67.36 KB
[REGISTER]   Saved locally: dave_20251101_201236_1.jpg
[REGISTER]   Sending to CodeProject.AI...
[REGISTER]   ✓ Photo 2 registered successfully
[REGISTER]   ✓ Saved to database
[REGISTER] Processing photo 3/6
[REGISTER]   Image size: 68.13 KB
[REGISTER]   Saved locally: dave_20251101_201237_2.jpg
[REGISTER]   Sending to CodeProject.AI...
[REGISTER]   ✓ Photo 3 registered successfully
[REGISTER]   ✓ Saved to database
[REGISTER] Processing photo 4/6
[REGISTER]   Image size: 68.75 KB
[REGISTER]   Saved locally: dave_20251101_201237_3.jpg
[REGISTER]   Sending to CodeProject.AI...
[REGISTER]   ✓ Photo 4 registered successfully
[REGISTER]   ✓ Saved to database
[REGISTER] Processing photo 5/6
[REGISTER]   Image size: 67.64 KB
[REGISTER]   Saved locally: dave_20251101_201237_4.jpg
[REGISTER]   Sending to CodeProject.AI...
[REGISTER]   ✓ Photo 5 registered successfully
[REGISTER]   ✓ Saved to database
[REGISTER] Processing photo 6/6
[REGISTER]   Image size: 68.41 KB
[REGISTER]   Saved locally: dave_20251101_201237_5.jpg
[REGISTER]   Sending to CodeProject.AI...
[REGISTER]   ✓ Photo 6 registered successfully
[REGISTER]   ✓ Saved to database
[REGISTER] Registration complete: 6/6 successful
============================================================

INFO:     172.16.1.150:35120 - "POST /api/register HTTP/1.1" 200 OK
